<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Taroria · 今日運勢</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-1: #060a1b;
      --bg-2: #121c3e;
      --panel: rgba(10, 16, 43, 0.56);
      --line: rgba(248, 215, 130, 0.36);
      --gold: #f7d58a;
      --text: #f5efe2;
      --shadow: rgba(0, 0, 0, 0.44);
          }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      font-family: "Cinzel Decorative", "Noto Serif TC", "PMingLiU", "MingLiU", serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background:
        radial-gradient(circle at 16% 18%, rgba(255, 221, 148, 0.2), transparent 36%),
        radial-gradient(circle at 86% 84%, rgba(94, 129, 255, 0.22), transparent 38%),
        linear-gradient(160deg, var(--bg-1), var(--bg-2));
      overflow-x: hidden;
      overflow-y: auto;
      padding: 16px 0 28px;
    }

    body::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background-image:
        radial-gradient(2px 2px at 23% 28%, rgba(255, 255, 255, 0.8), transparent),
        radial-gradient(1.6px 1.6px at 56% 22%, rgba(255, 255, 255, 0.68), transparent),
        radial-gradient(1.8px 1.8px at 74% 60%, rgba(255, 255, 255, 0.76), transparent),
        radial-gradient(1.6px 1.6px at 34% 74%, rgba(255, 255, 255, 0.78), transparent);
      opacity: 0.84;
      animation: twinkle 6s ease-in-out infinite alternate;
    }

    @keyframes twinkle {
      from { transform: translateY(0); opacity: 0.74; }
      to { transform: translateY(-5px); opacity: 1; }
    }

    .back {
      position: fixed;
      top: 18px;
      left: 18px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(8, 13, 33, 0.55);
      border: 1px solid rgba(248, 215, 130, 0.38);
      backdrop-filter: blur(4px);
      color: rgba(245, 239, 226, 0.9);
      text-decoration: none;
      z-index: 3;
    }

    .site-logo {
      position: fixed;
      top: 22px;
      left: 72px;
      z-index: 4;
      display: inline-block;
      pointer-events: none;
      width: max-content;
      font-family: "Cinzel Decorative", "Noto Serif TC", "PMingLiU", "MingLiU", serif;
      font-size: clamp(1.1rem, 2.5vw, 1.55rem);
      letter-spacing: 0.14em;
      color: transparent;
      background: linear-gradient(180deg, #ffeab5 0%, #f7d58a 45%, #c68f2b 100%);
      -webkit-background-clip: text;
      background-clip: text;
      text-shadow: 0 0 10px rgba(248, 215, 130, 0.32);
    }

    .back:hover { color: #fff4d5; }

    .back-icon {
      width: 22px;
      height: 22px;
      transform: rotate(180deg);
      filter: drop-shadow(0 0 4px rgba(247, 213, 138, 0.35));
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
      white-space: nowrap;
    }

    .layout {
      position: relative;
      z-index: 1;
      width: min(94vw, 980px);
      border-radius: 28px;
      padding: 36px 20px 30px;
      background: var(--panel);
      box-shadow: 0 26px 52px var(--shadow), inset 0 0 0 1px var(--line);
      backdrop-filter: blur(6px);
      margin: auto 0;
    }

    .title {
      margin: 0;
      text-align: center;
      font-family: "Cinzel Decorative", "Noto Serif TC", "PMingLiU", "MingLiU", serif;
      font-size: clamp(2rem, 5.2vw, 3.2rem);
      letter-spacing: 0.08em;
      color: var(--gold);
      text-shadow: 0 0 14px rgba(247, 213, 138, 0.33);
    }

    .hint {
      margin: 12px 0 28px;
      text-align: center;
      color: rgba(245, 239, 226, 0.9);
      font-size: clamp(1rem, 2.2vw, 1.12rem);
      letter-spacing: 0.04em;
    }

    .content {
      display: grid;
      grid-template-columns: minmax(220px, 280px) 1fr;
      gap: 20px;
      align-items: stretch;
    }

    .card-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
    }

    .img-en-name {
      margin: -4px 0 0;
      font-size: 0.9rem;
      color: rgba(245, 239, 226, 0.82);
      letter-spacing: 0.03em;
      min-height: 1.2em;
      text-align: center;
    }

    .tarot-card {
      width: min(74vw, 240px);
      aspect-ratio: 3 / 5;
      border: 0;
      border-radius: 18px;
      cursor: pointer;
      padding: 0;
      position: relative;
      perspective: 1000px;
      background: transparent;
      opacity: 0;
      transform: translateY(18px) scale(0.9);
      pointer-events: none;
      transition: opacity 320ms ease, transform 460ms cubic-bezier(0.2, 0.8, 0.22, 1);
    }

    .tarot-card.is-dealt {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    .tarot-card.is-dealt:hover {
      transform: translateY(-4px);
    }

    .tarot-card:disabled {
      cursor: wait;
    }

    .card-inner {
      display: block;
      position: relative;
      width: 100%;
      height: 100%;
      -webkit-transform-style: preserve-3d;
      transform-style: preserve-3d;
      transition: transform 780ms cubic-bezier(0.2, 0.8, 0.22, 1);
    }

    .tarot-card.is-flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-side {
      display: block;
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 18px;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      color: #f8f0db;
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.4), inset 0 0 0 2px rgba(248, 215, 130, 0.46);
      overflow: hidden;
    }

    .card-side img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .card-side::before {
      content: "";
      position: absolute;
      inset: 12px;
      border-radius: 12px;
      border: 1px solid rgba(248, 215, 130, 0.5);
    }

    .card-back {
      background: #0f173d;
    }

    .card-front {
      transform: rotateY(180deg);
      background: #111a45;
    }

    .card-front img.is-reversed {
      transform: rotate(180deg);
    }

    .draw-btn {
      border: 0;
      cursor: pointer;
      border-radius: 999px;
      padding: 12px 24px;
      font-family: "Cinzel Decorative", "Noto Serif TC", "PMingLiU", "MingLiU", serif;
      font-size: 1rem;
      font-weight: 700;
      color: #2d1b00;
      background: linear-gradient(140deg, #ffe5a7, #f0bf58);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.32);
    }

    .draw-btn:hover { filter: brightness(1.03); }

    .panel {
      border-radius: 18px;
      padding: 20px 20px 18px;
      background: rgba(8, 13, 34, 0.52);
      border: 1px solid rgba(248, 215, 130, 0.25);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .panel h2 {
      margin: 0;
      color: var(--gold);
      font-size: clamp(1.3rem, 3.6vw, 1.8rem);
      letter-spacing: 0.05em;
    }

    .en-name {
      margin: -4px 0 2px;
      color: rgba(245, 239, 226, 0.82);
      font-size: 0.95rem;
      letter-spacing: 0.03em;
    }

    .tag {
      display: inline-flex;
      width: fit-content;
      font-size: 0.9rem;
      color: #ffd88f;
      border-radius: 999px;
      padding: 5px 10px;
      background: rgba(255, 217, 143, 0.12);
      border: 1px solid rgba(255, 217, 143, 0.3);
    }

    .meaning {
      margin: 0;
      line-height: 1.75;
      color: rgba(245, 239, 226, 0.95);
      font-size: 1rem;
    }

    .tip {
      margin: 0;
      color: rgba(245, 239, 226, 0.8);
      font-size: 0.95rem;
    }

    .deep-wrap {
      margin-top: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .deep-btn {
      border: 0;
      cursor: pointer;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(8, 13, 33, 0.55);
      border: 1px solid rgba(248, 215, 130, 0.38);
      backdrop-filter: blur(4px);
      color: rgba(245, 239, 226, 0.9);
      box-shadow: none;
    }

    .deep-btn:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .deep-panel {
      display: none;
      margin-top: 10px;
      border-radius: 14px;
      padding: 14px;
      background: rgba(9, 14, 35, 0.72);
      border: 1px solid rgba(248, 215, 130, 0.25);
      width: 100%;
    }

    .deep-panel.open {
      display: block;
    }

    .arrow-icon {
      width: 22px;
      height: 22px;
      transition: transform 220ms ease;
      filter: drop-shadow(0 0 4px rgba(247, 213, 138, 0.35));
      transform: rotate(90deg);
    }

    .deep-btn.open .arrow-icon {
      transform: rotate(-90deg);
    }

    .deep-title {
      margin: 0 0 8px;
      color: var(--gold);
      font-size: 1.05rem;
    }

    .deep-text {
      margin: 0;
      white-space: pre-wrap;
      line-height: 1.8;
      color: rgba(245, 239, 226, 0.93);
      font-size: 0.97rem;
    }

    @media (max-width: 820px) {
      .content {
        grid-template-columns: 1fr;
      }

      .card-wrap {
        margin-bottom: 6px;
      }

      .tarot-card {
        width: min(62vw, 260px);
      }

      .site-logo {
        left: 70px;
        top: 24px;
        font-size: 1.05rem;
      }
    }
  </style>
</head>
<body>
  <div class="site-logo" aria-hidden="true">Taroria</div>
  <a class="back" href="./draw.html" aria-label="返回抽牌方式頁">
    <svg class="back-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M5 12H19" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" />
      <path d="M13 6L19 12L13 18" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
    <span class="sr-only">返回抽牌方式頁</span>
  </a>

  <main class="layout">
    <h1 class="title">今日運勢</h1>
    <p class="hint">先點擊“抽取今日牌”發牌背，再點擊牌背翻開今日指引</p>

    <section class="content">
      <div class="card-wrap">
        <button class="tarot-card" id="cardBtn" aria-label="點擊抽取今日塔羅牌">
          <span class="card-inner">
            <span class="card-side card-back"><img id="cardBackImg" alt="塔羅牌背" /></span>
            <span class="card-side card-front"><img id="cardFrontImg" alt="塔羅牌面" /></span>
          </span>
        </button>
        <p class="img-en-name" id="cardImgEnglishName">Waiting</p>
        <button class="draw-btn" id="drawBtn">抽取今日牌</button>
      </div>

      <article class="panel" aria-live="polite">
        <h2 id="cardName">等待抽牌</h2>
        <p class="en-name" id="cardEnglishName">Waiting to reveal</p>
        <span class="tag" id="cardDirection">今日提示</span>
        <p class="meaning" id="cardMeaning">你的能量還在匯聚。準備好後抽一張牌，查看今天的重點訊息。</p>
        <p class="tip">每日建議只抽一張，給自己一個清晰而穩定的行動方向。</p>
      </article>
    </section>

    <section class="deep-wrap" aria-live="polite">
      <button class="deep-btn" id="deepDailyBtn" disabled aria-label="展開深度解讀">
        <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M5 12H19" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" />
          <path d="M13 6L19 12L13 18" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        <span class="sr-only">深度解讀</span>
      </button>
      <article class="deep-panel" id="deepDailyPanel">
        <h3 class="deep-title">今日牌深度解讀</h3>
        <p class="deep-text" id="deepDailyText">翻開牌後，你可以在這裡查看更完整的解讀。</p>
      </article>
    </section>
  </main>

  <script src="./tarot-deck.js"></script>
  <script>

    const cardNameEl = document.getElementById('cardName');
    const cardEnglishNameEl = document.getElementById('cardEnglishName');
    const cardDirectionEl = document.getElementById('cardDirection');
    const cardMeaningEl = document.getElementById('cardMeaning');
    const cardBtnEl = document.getElementById('cardBtn');
    const drawBtnEl = document.getElementById('drawBtn');
    const cardBackImgEl = document.getElementById('cardBackImg');
    const cardFrontImgEl = document.getElementById('cardFrontImg');
    const cardImgEnglishNameEl = document.getElementById('cardImgEnglishName');
    const deepDailyBtnEl = document.getElementById('deepDailyBtn');
    const deepDailyPanelEl = document.getElementById('deepDailyPanel');
    const deepDailyTextEl = document.getElementById('deepDailyText');
    let pendingCard = null;
    let hasFlipped = false;
    cardBackImgEl.src = window.TAROT.cardBackImage;

    function buildDailyDeepReading(card) {
      const directionTone = card.reversed
        ? '我會更建議你先慢一點，把節奏調順，再往前推。'
        : '這張牌的能量比較順，你可以主動一點去推進想做的事。';

      return `你今天抽到的是「${card.name}（${card.englishName}）」${card.direction}。\n` +
        `先給你一句總提醒：${card.meaning}。${directionTone}\n\n` +
        `情感：\n` +
        `如果你在關係裡有點不安，這張牌在說“先把真實感受說清楚”。別急著爭對錯，先讓對方知道你在意什麼，氣氛會緩和很多。\n\n` +
        `工作：\n` +
        `今天適合做“一個關鍵推進點”，不要鋪太開。你把最重要的一件事做出結果，整體效率就會明顯上來。\n\n` +
        `金錢：\n` +
        `財務上建議走穩健路線。先看清支出結構，再決定要不要新增投入；衝動消費和臨時性大開銷，今天盡量壓一下。\n\n` +
        `運勢：\n` +
        `整體運勢屬於“可控可調”的類型。你越清楚自己當下的優先級，運勢就越容易站到你這邊。\n\n` +
        `你可以把今天的行動收斂成一句話：` +
        `“我先把最重要的一步走穩，再處理其他事情。”`;
    }

    function dealDailyCard() {
      pendingCard = window.TAROT.draw(1)[0];
      hasFlipped = false;
      cardBtnEl.classList.remove('is-dealt', 'is-flipped');
      void cardBtnEl.offsetWidth;
      cardBtnEl.classList.add('is-dealt');
      cardFrontImgEl.removeAttribute('src');
      cardFrontImgEl.classList.remove('is-reversed');
      cardImgEnglishNameEl.textContent = 'Waiting';
      cardNameEl.textContent = '等待翻牌';
      cardEnglishNameEl.textContent = 'Waiting to reveal';
      cardDirectionEl.textContent = '今日提示';
      cardMeaningEl.textContent = '牌已抽出。點擊左侧牌背，翻開你今天的訊息。';
      deepDailyBtnEl.disabled = true;
      deepDailyBtnEl.classList.remove('open');
      deepDailyPanelEl.classList.remove('open');
      deepDailyTextEl.textContent = '翻開牌後，你可以在這裡查看更完整的解讀。';
    }

    function flipDailyCard() {
      if (!pendingCard) return;
      hasFlipped = true;
      cardNameEl.textContent = pendingCard.name;
      cardEnglishNameEl.textContent = pendingCard.englishName;
      cardDirectionEl.textContent = pendingCard.direction;
      cardMeaningEl.textContent = pendingCard.meaning;
      cardFrontImgEl.src = pendingCard.image;
      cardFrontImgEl.classList.toggle('is-reversed', Boolean(pendingCard.reversed));
      cardImgEnglishNameEl.textContent = pendingCard.englishName;
      cardBtnEl.classList.add('is-flipped');
      deepDailyBtnEl.disabled = false;
    }

    function smoothFocusPanel(panelEl) {
      requestAnimationFrame(() => {
        window.scrollTo({
          top: Math.max(document.documentElement.scrollHeight - window.innerHeight, 0),
          behavior: 'smooth'
        });
      });
    }

    deepDailyBtnEl.addEventListener('click', () => {
      if (!pendingCard || !hasFlipped) return;
      const willOpen = !deepDailyPanelEl.classList.contains('open');
      if (willOpen) {
        deepDailyTextEl.textContent = buildDailyDeepReading(pendingCard);
        deepDailyPanelEl.classList.add('open');
        deepDailyBtnEl.classList.add('open');
        smoothFocusPanel(deepDailyPanelEl);
        return;
      }
      deepDailyPanelEl.classList.remove('open');
      deepDailyBtnEl.classList.remove('open');
    });

    drawBtnEl.addEventListener('click', dealDailyCard);
    cardBtnEl.addEventListener('click', flipDailyCard);
  </script>
</body>
</html>
