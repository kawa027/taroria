<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Taroria · 過去，現在，未來</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-1: #060a1b;
      --bg-2: #131e43;
      --panel: rgba(10, 16, 43, 0.56);
      --line: rgba(248, 215, 130, 0.36);
      --gold: #f7d58a;
      --text: #f5efe2;
      --shadow: rgba(0, 0, 0, 0.44);
          }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      font-family: "Cinzel Decorative", "Noto Serif TC", "PMingLiU", "MingLiU", serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background:
        radial-gradient(circle at 15% 18%, rgba(255, 221, 148, 0.2), transparent 36%),
        radial-gradient(circle at 84% 86%, rgba(90, 127, 255, 0.22), transparent 40%),
        linear-gradient(158deg, var(--bg-1), var(--bg-2));
      overflow-x: hidden;
      overflow-y: auto;
      padding: 16px 0 28px;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image:
        radial-gradient(2px 2px at 24% 28%, rgba(255, 255, 255, 0.8), transparent),
        radial-gradient(1.6px 1.6px at 54% 22%, rgba(255, 255, 255, 0.68), transparent),
        radial-gradient(1.8px 1.8px at 74% 60%, rgba(255, 255, 255, 0.76), transparent),
        radial-gradient(1.6px 1.6px at 36% 76%, rgba(255, 255, 255, 0.78), transparent);
      opacity: 0.84;
      animation: twinkle 6s ease-in-out infinite alternate;
    }

    @keyframes twinkle {
      from { transform: translateY(0); opacity: 0.74; }
      to { transform: translateY(-5px); opacity: 1; }
    }

    .back {
      position: fixed;
      top: 18px;
      left: 18px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(8, 13, 33, 0.55);
      border: 1px solid rgba(248, 215, 130, 0.38);
      backdrop-filter: blur(4px);
      color: rgba(245, 239, 226, 0.9);
      text-decoration: none;
      z-index: 3;
    }

    .site-logo {
      position: fixed;
      top: 22px;
      left: 72px;
      z-index: 4;
      display: inline-block;
      pointer-events: none;
      width: max-content;
      font-family: "Cinzel Decorative", "Noto Serif TC", "PMingLiU", "MingLiU", serif;
      font-size: clamp(1.1rem, 2.5vw, 1.55rem);
      letter-spacing: 0.14em;
      color: transparent;
      background: linear-gradient(180deg, #ffeab5 0%, #f7d58a 45%, #c68f2b 100%);
      -webkit-background-clip: text;
      background-clip: text;
      text-shadow: 0 0 10px rgba(248, 215, 130, 0.32);
    }

    .back:hover { color: #fff4d5; }

    .back-icon {
      width: 22px;
      height: 22px;
      transform: rotate(180deg);
      filter: drop-shadow(0 0 4px rgba(247, 213, 138, 0.35));
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
      white-space: nowrap;
    }

    .layout {
      width: min(96vw, 1120px);
      position: relative;
      z-index: 1;
      border-radius: 28px;
      padding: 32px 18px 30px;
      background: var(--panel);
      box-shadow: 0 26px 52px var(--shadow), inset 0 0 0 1px var(--line);
      backdrop-filter: blur(6px);
      margin: auto 0;
    }

    .title {
      margin: 0;
      text-align: center;
      font-family: "Cinzel Decorative", "Noto Serif TC", "PMingLiU", "MingLiU", serif;
      font-size: clamp(1.8rem, 5vw, 3rem);
      letter-spacing: 0.08em;
      color: var(--gold);
      text-shadow: 0 0 14px rgba(247, 213, 138, 0.33);
    }

    .hint {
      margin: 10px 0 22px;
      text-align: center;
      color: rgba(245, 239, 226, 0.9);
      font-size: clamp(0.95rem, 2.1vw, 1.08rem);
      letter-spacing: 0.04em;
    }

    .draw-btn {
      display: block;
      margin: 0 auto 20px;
      border: 0;
      cursor: pointer;
      border-radius: 999px;
      padding: 12px 28px;
      font-family: "Cinzel Decorative", "Noto Serif TC", "PMingLiU", "MingLiU", serif;
      font-size: 1rem;
      font-weight: 700;
      color: #2d1b00;
      background: linear-gradient(140deg, #ffe5a7, #f0bf58);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.32);
    }

    .spread {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }

    .slot {
      border-radius: 18px;
      padding: 14px;
      background: rgba(8, 13, 34, 0.5);
      border: 1px solid rgba(248, 215, 130, 0.25);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 430px;
    }

    .slot-title {
      margin: 0 0 10px;
      font-size: 1.05rem;
      letter-spacing: 0.08em;
      color: #ffe3a5;
    }

    .card {
      width: min(64vw, 190px);
      aspect-ratio: 3 / 5;
      border: 0;
      border-radius: 16px;
      cursor: pointer;
      position: relative;
      margin-bottom: 12px;
      perspective: 1000px;
      background: transparent;
      opacity: 0;
      transform: translateY(18px) scale(0.9);
      pointer-events: none;
      transition: opacity 320ms ease, transform 460ms cubic-bezier(0.2, 0.8, 0.22, 1);
    }

    .card.is-dealt {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    .card:disabled {
      cursor: wait;
    }

    .card-inner {
      display: block;
      position: relative;
      width: 100%;
      height: 100%;
      -webkit-transform-style: preserve-3d;
      transform-style: preserve-3d;
      transition: transform 760ms cubic-bezier(0.2, 0.8, 0.22, 1);
    }

    .card.is-flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-side {
      display: block;
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 16px;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      color: #f8f0db;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.38), inset 0 0 0 2px rgba(248, 215, 130, 0.46);
      overflow: hidden;
      font-family: "Cinzel Decorative", "Noto Serif TC", "PMingLiU", "MingLiU", serif;
      letter-spacing: 0.14em;
    }

    .card-side img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .card-side::before {
      content: "";
      position: absolute;
      inset: 10px;
      border-radius: 11px;
      border: 1px solid rgba(248, 215, 130, 0.5);
    }

    .card-back {
      background: #0f173d;
    }

    .card-front {
      transform: rotateY(180deg);
      background: #111a45;
    }

    .card-front img.is-reversed {
      transform: rotate(180deg);
    }

    .name {
      margin: 0;
      color: var(--gold);
      font-size: 1.2rem;
      text-align: center;
    }

    .en-name {
      margin: 6px 0 0;
      color: rgba(245, 239, 226, 0.82);
      font-size: 0.9rem;
      text-align: center;
      min-height: 1.2em;
    }

    .tag {
      margin-top: 8px;
      display: inline-flex;
      font-size: 0.86rem;
      color: #ffd88f;
      border-radius: 999px;
      padding: 5px 10px;
      background: rgba(255, 217, 143, 0.12);
      border: 1px solid rgba(255, 217, 143, 0.3);
    }

    .meaning {
      margin: 10px 0 0;
      line-height: 1.7;
      color: rgba(245, 239, 226, 0.95);
      font-size: 0.95rem;
      text-align: left;
      width: 100%;
    }

    .deep-wrap {
      margin-top: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .deep-btn {
      border: 0;
      cursor: pointer;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(8, 13, 33, 0.55);
      border: 1px solid rgba(248, 215, 130, 0.38);
      backdrop-filter: blur(4px);
      color: rgba(245, 239, 226, 0.9);
      box-shadow: none;
    }

    .deep-btn:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .deep-panel {
      display: none;
      margin-top: 10px;
      border-radius: 14px;
      padding: 14px;
      background: rgba(9, 14, 35, 0.72);
      border: 1px solid rgba(248, 215, 130, 0.25);
      width: 100%;
    }

    .deep-panel.open {
      display: block;
    }

    .arrow-icon {
      width: 22px;
      height: 22px;
      transition: transform 220ms ease;
      filter: drop-shadow(0 0 4px rgba(247, 213, 138, 0.35));
      transform: rotate(90deg);
    }

    .deep-btn.open .arrow-icon {
      transform: rotate(-90deg);
    }

    .deep-title {
      margin: 0 0 8px;
      color: var(--gold);
      font-size: 1.05rem;
    }

    .deep-text {
      margin: 0;
      white-space: pre-wrap;
      line-height: 1.8;
      color: rgba(245, 239, 226, 0.93);
      font-size: 0.97rem;
    }

    @media (max-width: 980px) {
      .spread {
        grid-template-columns: 1fr;
      }

      .slot {
        min-height: unset;
      }

      .card {
        width: min(52vw, 200px);
      }

      .site-logo {
        left: 70px;
        top: 24px;
        font-size: 1.05rem;
      }
    }
  </style>
</head>
<body>
  <div class="site-logo" aria-hidden="true">Taroria</div>
  <a class="back" href="./draw.html" aria-label="返回抽牌方式頁">
    <svg class="back-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M5 12H19" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" />
      <path d="M13 6L19 12L13 18" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
    <span class="sr-only">返回抽牌方式頁</span>
  </a>

  <main class="layout">
    <h1 class="title">過去，現在，未來</h1>
    <p class="hint">先點擊“抽取三張牌”發出牌背，再分別點擊每張牌背翻開</p>
    <button class="draw-btn" id="drawThreeBtn">抽取三張牌</button>

    <section class="spread" aria-live="polite">
      <article class="slot" data-slot="past">
        <h2 class="slot-title">過去</h2>
        <button class="card" aria-label="過去牌" id="pastCard">
          <span class="card-inner">
            <span class="card-side card-back"><img id="pastBackImg" alt="過去牌背" /></span>
            <span class="card-side card-front"><img id="pastFrontImg" alt="過去牌面" /></span>
          </span>
        </button>
        <h3 class="name" id="pastName">等待抽牌</h3>
        <p class="en-name" id="pastEn">Waiting</p>
        <span class="tag" id="pastDir">位置：過去</span>
        <p class="meaning" id="pastMeaning">這裡會展示過去影響你的關鍵能量。</p>
      </article>

      <article class="slot" data-slot="present">
        <h2 class="slot-title">現在</h2>
        <button class="card" aria-label="現在牌" id="presentCard">
          <span class="card-inner">
            <span class="card-side card-back"><img id="presentBackImg" alt="現在牌背" /></span>
            <span class="card-side card-front"><img id="presentFrontImg" alt="現在牌面" /></span>
          </span>
        </button>
        <h3 class="name" id="presentName">等待抽牌</h3>
        <p class="en-name" id="presentEn">Waiting</p>
        <span class="tag" id="presentDir">位置：現在</span>
        <p class="meaning" id="presentMeaning">這裡會展示你當前最核心的課題。</p>
      </article>

      <article class="slot" data-slot="future">
        <h2 class="slot-title">未來</h2>
        <button class="card" aria-label="未來牌" id="futureCard">
          <span class="card-inner">
            <span class="card-side card-back"><img id="futureBackImg" alt="未來牌背" /></span>
            <span class="card-side card-front"><img id="futureFrontImg" alt="未來牌面" /></span>
          </span>
        </button>
        <h3 class="name" id="futureName">等待抽牌</h3>
        <p class="en-name" id="futureEn">Waiting</p>
        <span class="tag" id="futureDir">位置：未來</span>
        <p class="meaning" id="futureMeaning">這裡會展示接下來發展的趨勢與建議。</p>
      </article>
    </section>

    <section class="deep-wrap" aria-live="polite">
      <button class="deep-btn" id="deepThreeBtn" disabled aria-label="展開深度解讀">
        <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M5 12H19" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" />
          <path d="M13 6L19 12L13 18" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        <span class="sr-only">深度解讀</span>
      </button>
      <article class="deep-panel" id="deepThreePanel">
        <h3 class="deep-title">三張牌深度解讀</h3>
        <p class="deep-text" id="deepThreeText">請先翻開過去、現在、未來三張牌，再查看整組解讀。</p>
      </article>
    </section>
  </main>

  <script src="./tarot-deck.js"></script>
  <script>

    function renderSlot(slot, picked) {
      document.getElementById(`${slot}Name`).textContent = picked.name;
      document.getElementById(`${slot}En`).textContent = picked.englishName;
      document.getElementById(`${slot}Dir`).textContent = `位置：${slot === 'past' ? '過去' : slot === 'present' ? '現在' : '未來'} · ${picked.direction}`;
      document.getElementById(`${slot}Meaning`).textContent = picked.meaning;
      const frontImg = document.getElementById(`${slot}FrontImg`);
      frontImg.src = picked.image;
      frontImg.classList.toggle('is-reversed', Boolean(picked.reversed));
    }

    const slotIds = ['past', 'present', 'future'];
    const drawThreeBtnEl = document.getElementById('drawThreeBtn');
    const deepThreeBtnEl = document.getElementById('deepThreeBtn');
    const deepThreePanelEl = document.getElementById('deepThreePanel');
    const deepThreeTextEl = document.getElementById('deepThreeText');
    const pendingCards = {};
    const flippedSlots = { past: false, present: false, future: false };

    function allSlotsFlipped() {
      return slotIds.every((slot) => flippedSlots[slot]);
    }

    function buildThreeCardDeepReading(cards) {
      const p = cards.past;
      const n = cards.present;
      const f = cards.future;
      const futureTone = f.reversed
        ? '我會建議你接下來先修正節奏，再談擴張。'
        : '這代表你後面的推進空間不錯，可以更主動一點。';

      return `我們先一起看這組三張牌：\n` +
        `過去：${p.name}（${p.englishName}）${p.direction}\n` +
        `現在：${n.name}（${n.englishName}）${n.direction}\n` +
        `未來：${f.name}（${f.englishName}）${f.direction}\n\n` +
        `先說整體感覺：你現在正處在“舊模式鬆動、新方向成形”的階段。` +
        `過去位在解釋你為什麼會卡住，現在位告訴你該把力氣放哪，未來位給你趨勢提醒。${futureTone}\n\n` +
        `情感：\n` +
        `這組牌更像在提醒你，關係裡要“少猜、多說”。把真實需求講出來，比反覆內耗有效。` +
        `如果有誤會，先處理情緒再談立場，會更容易和解。\n\n` +
        `工作：\n` +
        `當下工作重點是聚焦，不是加量。你把最核心任務先做深做透，結果會比同時開很多線更好。` +
        `尤其現在位這張牌，已經把優先級給得很清楚了。\n\n` +
        `金錢：\n` +
        `財務上建議“先穩後進”。過去位和現在位說明你可能受舊決策影響，` +
        `未來位則提醒你可以優化結構：先控風險、再找增長點，別讓情緒驅動花費。\n\n` +
        `運勢：\n` +
        `整體運勢不是突然暴漲型，而是「你越清楚，運就越順」。` +
        `你如果按現在位給出的方向持續1到2週，體感會明顯好轉，事情也會更有秩序感。\n\n` +
        `給你一句落地建議：\n` +
        `“先把眼前最關鍵的一步走對，再讓後面的機會自然展開。”`;
    }

    function resetSlot(slot) {
      const positionLabel = slot === 'past' ? '過去' : slot === 'present' ? '現在' : '未來';
      document.getElementById(`${slot}Card`).classList.remove('is-flipped');
      flippedSlots[slot] = false;
      document.getElementById(`${slot}Name`).textContent = '等待翻牌';
      document.getElementById(`${slot}En`).textContent = 'Waiting';
      document.getElementById(`${slot}Dir`).textContent = `位置：${positionLabel}`;
      document.getElementById(`${slot}Meaning`).textContent = '已抽好，點擊牌背翻開。';
      const backImg = document.getElementById(`${slot}BackImg`);
      const frontImg = document.getElementById(`${slot}FrontImg`);
      backImg.src = window.TAROT.cardBackImage;
      frontImg.removeAttribute('src');
      frontImg.classList.remove('is-reversed');
      deepThreeBtnEl.disabled = true;
    }

    function dealThreeCards() {
      const [past, present, future] = window.TAROT.draw(3);
      pendingCards.past = past;
      pendingCards.present = present;
      pendingCards.future = future;
      deepThreeBtnEl.disabled = true;
      deepThreeBtnEl.classList.remove('open');
      deepThreePanelEl.classList.remove('open');
      deepThreeTextEl.textContent = '請先翻開過去、現在、未來三張牌，再查看整組解讀。';
      slotIds.forEach((slot, index) => {
        const cardEl = document.getElementById(`${slot}Card`);
        cardEl.classList.remove('is-dealt', 'is-flipped');
        resetSlot(slot);
        setTimeout(() => {
          cardEl.classList.add('is-dealt');
        }, index * 90);
      });
    }

    function flipSlotCard(slot) {
      const picked = pendingCards[slot];
      if (!picked) return;
      renderSlot(slot, picked);
      document.getElementById(`${slot}Card`).classList.add('is-flipped');
      flippedSlots[slot] = true;
      deepThreeBtnEl.disabled = !allSlotsFlipped();
    }

    function smoothFocusPanel(panelEl) {
      requestAnimationFrame(() => {
        window.scrollTo({
          top: Math.max(document.documentElement.scrollHeight - window.innerHeight, 0),
          behavior: 'smooth'
        });
      });
    }

    deepThreeBtnEl.addEventListener('click', () => {
      if (!allSlotsFlipped()) return;
      const willOpen = !deepThreePanelEl.classList.contains('open');
      if (willOpen) {
        deepThreeTextEl.textContent = buildThreeCardDeepReading(pendingCards);
        deepThreePanelEl.classList.add('open');
        deepThreeBtnEl.classList.add('open');
        smoothFocusPanel(deepThreePanelEl);
        return;
      }
      deepThreePanelEl.classList.remove('open');
      deepThreeBtnEl.classList.remove('open');
    });

    drawThreeBtnEl.addEventListener('click', dealThreeCards);
    document.getElementById('pastCard').addEventListener('click', () => flipSlotCard('past'));
    document.getElementById('presentCard').addEventListener('click', () => flipSlotCard('present'));
    document.getElementById('futureCard').addEventListener('click', () => flipSlotCard('future'));
  </script>
</body>
</html>
